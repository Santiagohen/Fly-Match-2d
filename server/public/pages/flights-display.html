<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flights-Display</title>
    <style>
      #flightTable {
  margin: auto;
  width: 48%;
  border-collapse: collapse; /* Optional: for cleaner table borders */
}

#flightTable th, #flightTable td {
  text-align: center; /* Center content in table cells */
  padding: 10px; /* Add some padding for better spacing */
  border: 1px solid #000000; /* Optional: Add borders to cells */
}

    </style>
  </head>
  <body>
    <table id="flightTable">
      <thead>
        <tr>
          <th>Origin:</th>
          <th>Destination:</th>
          <th>Date:</th>
          <th>Time:</th>
          <th>Book Now</th>
        </tr>
      </thead>
      <tbody id="flightTableBody">
        <!-- data of users will be rendered here -->
      </tbody>
    </table>
    <script>
    


    async function fetchFlights() {
  try {
    const response = await fetch("/flights");
    if (!response.ok) {
      throw new Error("Error fetching flights. Response not ok");
    }
    const flights = await response.json();
    return flights;
  } catch (error) {
    console.error("There was a problem");
    console.error(error);
  }
}

async function updateUserBookedFlights(flightId) {
  try {
    const response = await fetch("/update-flight", {
      method: "POST", // Assuming a POST request to update the user
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ flightId }), // Send the flightId in the request body
    }
    )
    

    if (!response.ok) {
      throw new Error("Error updating user. Response not ok");
    }

    const updatedUser = await response.json();
    console.log("User updated:", updatedUser);
  }
   catch (error) {
    console.error("Error updating booked flights:", error);
  }

}


async function renderFlights() {
  const tableBody = document.getElementById("flightTableBody");
  tableBody.innerHTML = "";

  try {
    const flights = await fetchFlights();
    if (Array.isArray(flights) && flights.length > 0) {
      flights.forEach((flight) => {
        const row = `<tr>
            <td>${flight.origin}</td>
            <td>${flight.destination}</td>
            <td>${flight.date}</td>
            <td>${flight.time}</td>
            <td><button class="book-button" id="book-${flight.flightsId}">BOOK</button></td>
          </tr>`;
        tableBody.innerHTML += row;
      });

      // Add event listeners to each book button
      document.querySelectorAll(".book-button").forEach((button) => {
        button.addEventListener("click", function () {
          const flightId = this.id.replace("book-", ""); // Extract flightId from the button id
          updateUserBookedFlights(flightId); // Call the function to update the user's booked flights
        });
      });
    }
  } catch (error) {
    console.error("Error rendering flights:", error);
  }
}

// Call renderFlights to display the flights on page load or whenever needed

      
      document.addEventListener("DOMContentLoaded", renderFlights);
     
      
      // Select all elements with the class 'myButton'
      

      // Loop through each button and add the async event listener
      
      </script>
  </body>
</html>
